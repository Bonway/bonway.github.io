<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #f0f0f0; /*è¿›åº¦æ¡é¢œè‰²*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*é˜´å½±é¢œè‰²*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*ä¸Šè¾¹æ¡†é¢œè‰²*/
        border-left-color: #1E92FB;    /*å·¦è¾¹æ¡†é¢œè‰²*/
    }
</style>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOSæºç è§£æ," />





  <link rel="alternate" href="/atom.xml" title="Bonway" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="A fast, convenient and nonintrusive conversion between JSON and model.è½¬æ¢é€Ÿåº¦å¿«ã€ä½¿ç”¨ç®€å•æ–¹ä¾¿çš„å­—å…¸è½¬æ¨¡å‹æ¡†æ¶

æ€»ä½“æ¥è¯´ï¼šä¸Šæ‰‹å¿«ï¼Œä½¿ç”¨ç®€å•ã€‚

å…³é”®ç±»123456#import &amp;quot;NSObject+MJCoding.h&amp;quot;#import &amp;quot;NSObject+MJProperty.h&amp;quot;#i">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS MJExtensionæºç è§£æ">
<meta property="og:url" content="http://yoursite.com/2016/03/08/MJExtensionæºç è§£æ/index.html">
<meta property="og:site_name" content="Bonway">
<meta property="og:description" content="A fast, convenient and nonintrusive conversion between JSON and model.è½¬æ¢é€Ÿåº¦å¿«ã€ä½¿ç”¨ç®€å•æ–¹ä¾¿çš„å­—å…¸è½¬æ¨¡å‹æ¡†æ¶

æ€»ä½“æ¥è¯´ï¼šä¸Šæ‰‹å¿«ï¼Œä½¿ç”¨ç®€å•ã€‚

å…³é”®ç±»123456#import &amp;quot;NSObject+MJCoding.h&amp;quot;#import &amp;quot;NSObject+MJProperty.h&amp;quot;#i">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/10991770-f46ba34a1b9961a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-03-14T08:49:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS MJExtensionæºç è§£æ">
<meta name="twitter:description" content="A fast, convenient and nonintrusive conversion between JSON and model.è½¬æ¢é€Ÿåº¦å¿«ã€ä½¿ç”¨ç®€å•æ–¹ä¾¿çš„å­—å…¸è½¬æ¨¡å‹æ¡†æ¶

æ€»ä½“æ¥è¯´ï¼šä¸Šæ‰‹å¿«ï¼Œä½¿ç”¨ç®€å•ã€‚

å…³é”®ç±»123456#import &amp;quot;NSObject+MJCoding.h&amp;quot;#import &amp;quot;NSObject+MJProperty.h&amp;quot;#i">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/10991770-f46ba34a1b9961a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2016/03/08/MJExtensionæºç è§£æ/"/>





  <title>iOS MJExtensionæºç è§£æ | Bonway</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?da99a021876cb72e63bbf0f27d367af7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <a href="http://blog.linqipuzi.com"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bonway</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/03/08/MJExtensionæºç è§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bonway">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/mine.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bonway">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">iOS MJExtensionæºç è§£æ</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2016-03-08T18:02:22+08:00">
                2016-03-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOSè¿›é˜¶/" itemprop="url" rel="index">
                    <span itemprop="name">iOSè¿›é˜¶</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2016/03/08/MJExtensionæºç è§£æ/#SOHUCS" itemprop="discussionUrl">
                  <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2016/03/08/MJExtensionæºç è§£æ/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          
             <span id="/2016/03/08/MJExtensionæºç è§£æ/" class="leancloud_visitors" data-flag-title="iOS MJExtensionæºç è§£æ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>A fast, convenient and nonintrusive conversion between JSON and model.<br>è½¬æ¢é€Ÿåº¦å¿«ã€ä½¿ç”¨ç®€å•æ–¹ä¾¿çš„å­—å…¸è½¬æ¨¡å‹æ¡†æ¶</p>
</blockquote>
<p>æ€»ä½“æ¥è¯´ï¼šä¸Šæ‰‹å¿«ï¼Œä½¿ç”¨ç®€å•ã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/10991770-f46ba34a1b9961a4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<h2 id="å…³é”®ç±»"><a href="#å…³é”®ç±»" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#import &quot;NSObject+MJCoding.h&quot;</div><div class="line">#import &quot;NSObject+MJProperty.h&quot;</div><div class="line">#import &quot;NSObject+MJClass.h&quot;</div><div class="line">#import &quot;NSObject+MJKeyValue.h&quot;</div><div class="line">#import &quot;NSString+MJExtension.h&quot;</div><div class="line">#import &quot;MJExtensionConst.h&quot;</div></pre></td></tr></table></figure>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›è¾…åŠ©ç±»ï¼Œæ¯”å¦‚ï¼š<code>MJFoundation.h</code>ã€<code>MJProperty.h</code>ã€<code>MJPropertyKey.h</code>ã€<code>MJPropertyType.h</code>ã€‚</p>
<p>æ ¹æ®ç±»çš„åå­—ï¼Œå¤§è‡´å°±èƒ½çŒœåˆ°æ˜¯ç”¨æ¥åšä»€ä¹ˆç”¨çš„ã€‚æˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„å¼€å§‹åˆ†æã€‚</p>
<h2 id="MJExtensionConst"><a href="#MJExtensionConst" class="headerlink" title="MJExtensionConst"></a>MJExtensionConst</h2><p>è¿™é‡Œå®šä¹‰äº†æ•´ä¸ªåº“çš„å¸¸é‡å’Œå®å®šä¹‰ã€‚ç±»ä¼¼äºä¸€ä¸ªé¡¹ç›®ä¸­çš„é¢„ç¼–è¯‘æ–‡ä»¶ã€‚åŒ…å«äº†<code>æ–¹æ³•å¼ƒç”¨å®</code>ï¼Œ<code>è‡ªå®šä¹‰Logæ—¥å¿—</code>ã€<code>è‡ªå®šä¹‰æ–­è¨€</code>ã€<code>å¿«é€Ÿæ‰“å°æ‰€æœ‰å±æ€§</code>ã€<code>è‡ªå®šä¹‰ç±»å‹ç¼–ç å­—ç¬¦ä¸²å¸¸é‡</code></p>
<ul>
<li>æ–¹æ³•å¼ƒç”¨ï¼šä¸€èˆ¬åœ¨åšé¡¹ç›®ä¸­æ¯”è¾ƒå°‘ç”¨åˆ°ï¼Œåš<code>SDK</code>ç”¨åˆ°çš„æœºä¼šæ¯”è¾ƒå¤§ã€‚<code>#define MJExtensionDeprecated(instead) NS_DEPRECATED(2_0, 2_0, 2_0, 2_0, instead)</code>å¯èƒ½å¥½å¤šåŒå­¦å¯¹è¿™é‡Œçš„2_0ä¸æ˜¯å¾ˆæ‡‚ã€‚è¿™é‡Œç®€å•æ‰©å±•ä¸€ä¸‹ï¼š</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">   ä¸€ã€NS_AVAILABEL_IOS</div><div class="line">ä¾‹å¦‚ï¼š</div><div class="line">- (void)presentViewController:(UIViewController *)viewControllerToPresent animated: (BOOL)flag completion:(void (^)(void))completion NS_AVAILABLE_IOS(5_0);</div><div class="line">è¯¥NS_AVAILABLE_IOS(5_0)å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨iOS5.0åŠä»¥åçš„ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚å¦‚æœæˆ‘ä»¬åœ¨æ¯”æŒ‡å®šç‰ˆæœ¬æ›´è€çš„ç‰ˆæœ¬ä¸­è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°±ä¼šå¼•èµ·å´©æºƒã€‚</div><div class="line"></div><div class="line">   äºŒã€NS_AVAILABLE</div><div class="line">    - (void)setObject:(id)obj atIndexedSubscript:(NSUInteger)idx NS_AVAILABLE(10_8, 6_0);</div><div class="line">è¿™é‡Œçš„NS_AVAILABLEå®å‘Šè¯‰æˆ‘ä»¬è¿™æ–¹æ³•åˆ†åˆ«éšMac OS 10.8å’ŒiOS 6.0è¢«å¼•å…¥ã€‚</div><div class="line"></div><div class="line">   ä¸‰ã€NS_DEPRECATED_IOS</div><div class="line"></div><div class="line">   ä¾‹å¦‚ï¼š</div><div class="line"></div><div class="line">   - (void)presentModalViewController:(UIViewController *)modalViewController animated:(BOOL)animated NS_DEPRECATED_IOS(2_0, 6_0);</div><div class="line">NS_DEPRECATED_IOS(2_0, 6_0) </div><div class="line">è¿™é‡Œçš„å®æœ‰ä¸¤ä¸ªç‰ˆæœ¬å·ï¼Œå‰é¢ä¸€ä¸ªè¡¨æ˜äº†è¿™ä¸ªæ–¹æ³•è¢«å¼•å…¥æ—¶çš„iOSç‰ˆæœ¬ï¼Œåé¢ä¸€ä¸ªè¡¨åå®ƒè¢«åºŸå¼ƒæ—¶çš„iOSç‰ˆæœ¬ã€‚æœ¬åºŸå¼ƒå¹¶ä¸æ˜¯æŒ‡è¿™ä¸ªæ–¹æ³•å°±ä¸å­˜åœ¨äº†ï¼ŒçŸ¥è¯†æ„å‘³ç€æˆ‘ä»¬åº”å½“å¼€å§‹è€ƒè™‘å°†ç›¸å…³ä»£ç è¿ç§»åˆ°æ–°çš„APIä¸Šå»äº†ã€‚</div><div class="line"></div><div class="line">   å››ã€NS_DEPRECATED</div><div class="line">   ä¾‹å¦‚ï¼š</div><div class="line">- (void)removeObjectsFromIndices:(NSUInteger *)indices numIndices:(NSUInteger)cnt NS_DEPRECATED(10_0, 10_6, 2_0, 4_0);</div><div class="line">è¿™é‡Œè¡¨ç¤ºè¿™ä¸ªæ–¹æ³•è™½Max OS 10.0å’ŒiOS 2.0è¢«å¼•å…¥ï¼Œåœ¨Mac OS 10.6å’ŒiOS 4.0åèƒŒåºŸå¼ƒã€‚</div></pre></td></tr></table></figure>
<p>   æ ¹æ®ä¸Šé¢çš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é‡Œçš„<code>#define MJExtensionDeprecated(instead) NS_DEPRECATED(2_0, 2_0, 2_0, 2_0, instead)</code>ä»£ç åœ¨Max OS 2.0å’ŒiOS 2.0è¢«å¼•å…¥ï¼Œåœ¨Mac OS 2.0å’ŒiOS 2.0åèƒŒåºŸå¼ƒã€‚æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆä¸å¯¹ï¼Ÿï¼ŸğŸ˜’ğŸ˜’</p>
<ul>
<li><p>å®å®šä¹‰å‡½æ•°ï¼ˆæ—¥å¿—è¾“å‡ºï¼Œæ„å»ºé”™è¯¯ç­‰ï¼‰ï¼šçœ‹ä¸€ä¸ªæ–­è¨€çš„ä¾‹å­</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#define MJExtensionAssertError(condition, returnValue, clazz, msg) \</div><div class="line">[clazz setMj_error:nil]; \</div><div class="line">if ((condition) == NO) &#123; \</div><div class="line">   MJExtensionBuildError(clazz, msg); \</div><div class="line">   return returnValue;\</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">æœ‰ä¸€ä¸ªç»†èŠ‚`(condition)`ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆè¦ç”¨ï¼ˆconditionï¼‰å¤šåŠ ä¸€å¯¹æ‹¬å·ï¼Œå› ä¸ºconditionhæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸ºäº†ä¿è¯æ‰§è¡Œé¡ºåºã€‚</div><div class="line"></div><div class="line">è¿™ç§ç‰¹æ€§æ˜¯ä»cè¯­è¨€ç§»æ¤è¿‡æ¥çš„ï¼Œåœ¨å®å®šä¹‰æ¯è¡Œæœ€ååŠ ä¸Šæ–œæ `\`ï¼Œè¡¨ç¤ºå®å®šä¹‰å‡½æ•°ï¼Œå¦‚æœæœ‰å‚æ•°å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„ä¾‹å­è¿›è¡Œä¼ é€’ã€‚</div></pre></td></tr></table></figure>
<ul>
<li>æœ€åæ¥çœ‹ä¸€çœ‹ç±»å‹ç¼–ç ï¼šå¤§è‡´æ ¹æ®åç§°å°±çŸ¥é“ç¬¦å·ä»£è¡¨ä»€ä¹ˆç±»å‹çš„å‚æ•°</li>
</ul>
<p>NSString <em>const MJPropertyTypeInt = @â€iâ€;<br>NSString </em>const MJPropertyTypeShort = @â€sâ€;<br>NSString <em>const MJPropertyTypeFloat = @â€fâ€;<br>NSString </em>const MJPropertyTypeDouble = @â€dâ€;<br>NSString <em>const MJPropertyTypeLong = @â€lâ€;<br>NSString </em>const MJPropertyTypeLongLong = @â€qâ€;<br>NSString <em>const MJPropertyTypeChar = @â€câ€;<br>NSString </em>const MJPropertyTypeBOOL1 = @â€câ€;<br>NSString <em>const MJPropertyTypeBOOL2 = @â€bâ€;<br>NSString </em>const MJPropertyTypePointer = @â€<em>â€œ;<br>NSString </em>const MJPropertyTypeIvar = @â€^{objc_ivar=}â€;<br>NSString <em>const MJPropertyTypeMethod = @â€^{objc_method=}â€;<br>NSString </em>const MJPropertyTypeBlock = @â€@?â€;<br>NSString <em>const MJPropertyTypeClass = @â€#â€;<br>NSString </em>const MJPropertyTypeSEL = @â€:â€;<br>NSString *const MJPropertyTypeId = @â€@â€;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## MJFoundation.h</div><div class="line"></div><div class="line">è¿™ä¸ªç±»åšçš„äº‹æƒ…å°±æ˜¯åˆ¤æ–­ç±»æ˜¯ä¸æ˜¯å±äº`Foundation`æ¡†æ¶é‡Œé¢çš„ã€‚å¯èƒ½å¾ˆå¥½å¥‡å¦‚ä½•åˆ¤æ–­è¿™ä¸ªç±»æ˜¯ä¸æ˜¯`Foundation `æ¡†æ¶å‘¢ã€‚è¿™é‡Œç”¨çš„æ˜¯ç©·ä¸¾æ³•ï¼Œç”±äºæ¡†æ¶é‡Œé¢çš„ç±»å¤ªå¤šã€‚è¿™é‡Œå°±æŠŠæœ€åå¸¸ç”¨çš„å‡ ä¸ªç±»è¿›è¡Œåˆ¤æ–­ã€‚å¦‚ä¸‹ï¼š</div></pre></td></tr></table></figure>
<p>foundationClasses_ = [NSSet setWithObjects:<br>[NSURL class],<br>[NSDate class],<br>[NSValue class],<br>[NSData class],<br>[NSError class],<br>[NSArray class],<br>[NSDictionary class],<br>[NSString class],<br>[NSAttributedString class], nil];</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ç„¶ååˆ¤æ–­</div></pre></td></tr></table></figure>
<ul>
<li><p>(BOOL)isClassFromFoundation:(Class)c<br>{<br>if (c == [NSObject class] || c == [NSManagedObject class]) return YES;</p>
<p>__block BOOL result = NO;<br>[[self foundationClasses] enumerateObjectsUsingBlock:^(Class foundationClass, BOOL <em>stop) {<br>if ([c isSubclassOfClass:foundationClass]) {<br>result = YES;
</em>stop = YES;<br>}<br>}];<br>return result;<br>}</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">è¿™é‡ŒåŠ `__block`æ˜¯ä¸ºäº†åœ¨`block`å†…éƒ¨å¯ä»¥ä¿®æ”¹`result`.</div><div class="line"></div><div class="line">## NSString+MJExtension.h</div><div class="line"></div><div class="line">è¿™ä¸ªç±»ä½œç”¨å°±æ˜¯å¯¹å­—ç¬¦ä¸²çš„ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å˜é‡çš„å‘½åæ–¹æ³•è½¬æ¢ã€‚å¸¸è§çš„`é©¼å³°è½¬ä¸‹åˆ’çº¿ï¼ˆloveYou -&gt; love_youï¼‰`ã€`ä¸‹åˆ’çº¿è½¬é©¼å³°ï¼ˆlove_you -&gt; loveYouï¼‰`ã€`é¦–å­—æ¯å˜å¤§å†™`ã€`é¦–å­—æ¯å˜å°å†™`ã€`æ˜¯ä¸æ˜¯æ•´å½¢`ã€`æ˜¯ä¸æ˜¯URLæ ¼å¼`</div><div class="line"></div><div class="line">**å…¶å®å°±æ˜¯ä¸€ä¸ªå·¥å…·åˆ†ç±»,æ“ä½œå˜é‡æˆ–è€…å±æ€§å**</div><div class="line"></div><div class="line">## MJPropertyTypeï¼ˆåŸºç¡€ç±»å‹ï¼‰</div><div class="line"></div><div class="line">å¯¹å±æ€§çš„å…·ä½“ç±»å‹è¿›è¡Œå°è£…ï¼Œç®€å•æ¥è¯´å°±æ˜¯è®²ç±»å‹ç¼–ç è½¬ä¸ºæˆ‘ä»¬ç†ŸçŸ¥çš„ç±»å‹ã€‚æš´éœ²ç»™å¤–é¢ä½¿ç”¨ï¼Œå…¶å±æ€§å¦‚ä¸‹ï¼š</div></pre></td></tr></table></figure>
<p>/<em>* ç±»å‹æ ‡è¯†ç¬¦ï¼Œç±»å‹ç¼–ç  </em>/<br>@property (nonatomic, copy) NSString *code;</p>
<p>/<em>* æ˜¯å¦ä¸ºidç±»å‹ </em>/<br>@property (nonatomic, readonly, getter=isIdType) BOOL idType;</p>
<p>/<em>* æ˜¯å¦ä¸ºåŸºæœ¬æ•°å­—ç±»å‹ï¼šintã€floatç­‰ </em>/<br>@property (nonatomic, readonly, getter=isNumberType) BOOL numberType;</p>
<p>/<em>* æ˜¯å¦ä¸ºBOOLç±»å‹ </em>/<br>@property (nonatomic, readonly, getter=isBoolType) BOOL boolType;</p>
<p>/<em>* å¯¹è±¡ç±»å‹ï¼ˆå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ­¤å€¼ä¸ºnilï¼‰ </em>/<br>@property (nonatomic, readonly) Class typeClass;</p>
<p>/<strong> ç±»å‹æ˜¯å¦æ¥è‡ªäºFoundationæ¡†æ¶ï¼Œæ¯”å¦‚NSStringã€NSArray */<br>@property (nonatomic, readonly, getter = isFromFoundation) BOOL fromFoundation;<br>/</strong> ç±»å‹æ˜¯å¦ä¸æ”¯æŒKVC */<br>@property (nonatomic, readonly, getter = isKVCDisabled) BOOL KVCDisabled;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">é€šè¿‡ç±»æ–¹æ³•åˆå§‹åŒ–`+ (instancetype)cachedTypeWithCode:(NSString *)code`ã€‚</div><div class="line"></div><div class="line">**å› ä¸ºæ€»å…±çš„ç±»å‹å°±å¦‚ä¸Šæåˆ°çš„é‚£å‡ ç§ï¼Œæ‰€ä»¥è¿™é‡Œç”¨äº†ä¸€ä¸ªé™æ€çš„å­—å…¸ä¿å­˜ç»“æœã€‚ä¸‹æ¬¡ç›´æ¥ä»ç»“æœä¸­å–ï¼Œå¦‚æœæœ‰åˆ™ä¸ç”¨ä¾æ¬¡åˆ¤æ–­äº†**</div></pre></td></tr></table></figure>
<p>static NSMutableDictionary *types_;// é™æ€å­—å…¸</p>
<ul>
<li>(void)initialize<br>{<br>types_ = [NSMutableDictionary dictionary];<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">æ³¨æ„è¿™é‡Œçš„`initialize `ï¼Œå¦‚æœä½ å¯¹`Swizzle`ç†Ÿæ‚‰ï¼Œé‚£ä¹ˆ`load`åº”è¯¥çŸ¥é“ã€‚é¡ºä¾¿å°±æä¸‹ä¸¤è€…çš„åŒºåˆ«ã€‚</div><div class="line"></div><div class="line">|å¯¹æ¯”ç‚¹|   +(void)load|+(void)initialize|</div><div class="line">|:--:|:--:|:--:|</div><div class="line">| æ‰§è¡Œæ—¶æœº  |åœ¨ç¨‹åºè¿è¡Œåç«‹å³æ‰§è¡Œ|    åœ¨ç±»çš„æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒæ—¶æ‰§è¡Œ|</div><div class="line">|è‹¥è‡ªèº«æœªå®šä¹‰ï¼Œæ˜¯å¦æ²¿ç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Ÿ| å¦|  æ˜¯|</div><div class="line">| ç±»åˆ«ä¸­çš„å®šä¹‰    |   å…¨éƒ½æ‰§è¡Œï¼Œä½†åäºç±»ä¸­çš„æ–¹æ³•   | è¦†ç›–ç±»ä¸­çš„æ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€ä¸ª|</div><div class="line"></div><div class="line">é‚£ç¼“å­˜æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</div><div class="line"></div><div class="line">ä¸€èˆ¬ç¼“å­˜çš„æ€è·¯éƒ½ä¸€æ ·ï¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™ä¿å­˜ç»“æœã€‚å¦‚æœä»¥åæœ‰ç›¸åŒçš„æƒ…å†µåˆ™ç›´æ¥ä»ä»¥å‰çš„ç»“æœä¸­è¿”å›å°±å¯ä»¥äº†ã€‚</div></pre></td></tr></table></figure>
<ul>
<li><p>(instancetype)cachedTypeWithCode:(NSString *)code<br>{<br>MJExtensionAssertParamNotNil2(code, nil);</p>
<p>// ä»ç¼“å­˜ä¸­å–ï¼Œå¦‚æœæ²¡æœ‰æ‰å»è®¾ç½®<br>MJPropertyType *type = types<em>[code];<br>if (type == nil) {<br>type = [[self alloc] init];<br>type.code = code;<br>// å­˜å‚¨èµ·æ¥<br>types</em>[code] = type;<br>}<br>return type;<br>}</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">æ¥ä¸‹é‡Œçœ‹çœ‹ç±»å‹ç¼–ç çš„è½¬æ¢éƒ¨åˆ†ã€‚</div></pre></td></tr></table></figure>
<p>// å‚æ•°ç±»å‹è½¬æ¢</p>
<ul>
<li><p>(void)setCode:(NSString *)code<br>{<br>_code = code;</p>
<p>MJExtensionAssertParamNotNil(code);</p>
<p>if ([code isEqualToString:MJPropertyTypeId]) {<br>_idType = YES;<br>} else if (code.length == 0) {<br>_KVCDisabled = YES;<br>} else if (code.length &gt; 3 &amp;&amp; [code hasPrefix:@â€@â€â€]) {<br>// å»æ‰@â€å’Œâ€ï¼Œæˆªå–ä¸­é—´çš„ç±»å‹åç§°<br>_code = [code substringWithRange:NSMakeRange(2, code.length - 3)];<br>// å¾—åˆ°ç±»å‹ç±»å‹<br>_typeClass = NSClassFromString(_code);<br>_fromFoundation = [MJFoundation isClassFromFoundation:_typeClass];<br>// æ˜¯å¦ä¸ºNSNumberç±»å‹<br>_numberType = [_typeClass isSubclassOfClass:[NSNumber class]];</p>
<p>} else if ([code isEqualToString:MJPropertyTypeSEL] ||<br>[code isEqualToString:MJPropertyTypeIvar] ||<br>[code isEqualToString:MJPropertyTypeMethod]) {<br>_KVCDisabled = YES;<br>}</p>
<p>// æ˜¯å¦ä¸ºæ•°å­—ç±»å‹<br>NSString <em>lowerCode = _code.lowercaseString;<br>NSArray </em>numberTypes = @[MJPropertyTypeInt, MJPropertyTypeShort, MJPropertyTypeBOOL1, MJPropertyTypeBOOL2, MJPropertyTypeFloat, MJPropertyTypeDouble, MJPropertyTypeLong, MJPropertyTypeLongLong, MJPropertyTypeChar];</p>
<p>// æ˜¯å¦ä¸ºåŸºæœ¬æ•°æ®ç±»å‹<br>if ([numberTypes containsObject:lowerCode]) {<br>_numberType = YES;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if ([lowerCode isEqualToString:MJPropertyTypeBOOL1]</div><div class="line">    || [lowerCode isEqualToString:MJPropertyTypeBOOL2]) &#123;</div><div class="line">    _boolType = YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>}<br>}</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">æ¯”è¾ƒé‡è¦çš„æ˜¯è¿™ä¸€æ®µ</div></pre></td></tr></table></figure>
<p>if ([code isEqualToString:MJPropertyTypeId]) {<br>_idType = YES;<br>} else if (code.length == 0) {<br>_KVCDisabled = YES;<br>} else if (code.length &gt; 3 &amp;&amp; [code hasPrefix:@â€@â€â€]) {<br>// å»æ‰@â€å’Œâ€ï¼Œæˆªå–ä¸­é—´çš„ç±»å‹åç§°<br>_code = [code substringWithRange:NSMakeRange(2, code.length - 3)];<br>// å¾—åˆ°ç±»å‹ç±»å‹<br>_typeClass = NSClassFromString(_code);<br>_fromFoundation = [MJFoundation isClassFromFoundation:_typeClass];<br>// æ˜¯å¦ä¸ºNSNumberç±»å‹<br>_numberType = [_typeClass isSubclassOfClass:[NSNumber class]];</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#125; else if ([code isEqualToString:MJPropertyTypeSEL] ||</div><div class="line">           [code isEqualToString:MJPropertyTypeIvar] ||</div><div class="line">           [code isEqualToString:MJPropertyTypeMethod]) &#123;</div><div class="line">    _KVCDisabled = YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ä¼ è¿›æ¥çš„`code`å°±æ˜¯å±æ€§æ‰€å¯¹åº”çš„å±æ€§åç§°ï¼Œæ¯”å¦‚`NSArray`å¯¹åº”`@&quot;NSArray&quot;`ã€‚è‡ªå®šä¹‰çš„ç±»ï¼Œç­¾åéƒ½ä¼šæœ‰ä¸€ä¸ª`@`ç¬¦å·ï¼Œåé¢æ¥ä¸Šç±»åã€‚å½¢å¼å¦‚`@Classname`ã€‚</div><div class="line"></div><div class="line">## MJPropertyKey.h</div><div class="line"></div><div class="line">è¿™ä¸ªç±»æ˜¯å¯¹å±æ€§è¿›è¡Œåˆ†ç±»ã€‚æ‰€æœ‰å±æ€§å¯ä»¥å½’ä¸ºä¸¤ç±»ä¸€ç§æ˜¯å­—å…¸ï¼Œä¹Ÿå°±æ˜¯é”®å€¼å¯¹ï¼ˆ`NSDictionary`ï¼‰å’Œæ•°ç»„ï¼ˆ`NSArray`ï¼‰ã€‚</div><div class="line"></div><div class="line">å¤–é¢é€šè¿‡è°ƒç”¨`- (id)valueInObject:(id)object`ä»ä¼ è¿›æ¥çš„`id`ç±»å‹ä¸­å–å€¼ã€‚</div><div class="line"></div><div class="line">## MJProperty.h</div><div class="line"></div><div class="line">å¯¹`objc_property_t`å°è£…ï¼Œå­˜å‚¨ä¸€ä¸ªå±æ€§å€¼ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ï¼Œå°†`objc_property_t`è½¬ä¸ºèƒ½å¤Ÿç›´æ¥ç”¨çš„å¯¹è±¡ã€‚å®ƒæ˜¯å¯¹`objc_property_t`ç±»å‹çš„ä¸€æ¬¡å°è£…ï¼Œä¾¿äºæˆ‘ä»¬ä½¿ç”¨ã€‚åŒäº‹å®ƒä¹Ÿä¾èµ–äºä¸Šé¢æ‰€ä»‹ç»çš„å‡ ç§æ•°æ®ç±»å‹ã€‚ä»`.h`æ–‡ä»¶çœ‹åˆ°`#import &quot;MJPropertyType.h&quot; #import &quot;MJPropertyKey.h&quot;`ã€‚åŒæ ·ä¹Ÿä¾èµ–äº`#import &quot;MJFoundation.h&quot; #import &quot;MJExtensionConst.h&quot;`</div><div class="line"></div><div class="line">åˆå§‹åŒ–å…¥å£å‡½æ•°`+ (instancetype)cachedPropertyWithProperty:(objc_property_t)property`ã€‚æ­£å¦‚ä¸Šé¢æ‰€è¯´ç›®çš„å°±æ˜¯å°†`runtime`ä¸­çš„`objc_property_t `è½¬ä¸º`MJProperty`æ–¹ä¾¿æˆ‘ä»¬çš„ä½¿ç”¨ã€‚</div><div class="line"></div><div class="line">å…·ä½“å®ç°ï¼š</div></pre></td></tr></table></figure>
<ul>
<li>(instancetype)cachedPropertyWithProperty:(objc_property_t)property<br>{<br>MJProperty *propertyObj = objc_getAssociatedObject(self, property);<br>if (propertyObj == nil) {<br>propertyObj = [[self alloc] init];<br>// è½¬ä¸ºMJProperty<br>propertyObj.property = property;<br>objc_setAssociatedObject(self, property, propertyObj, OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>}<br>return propertyObj;<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">` MJProperty *propertyObj = objc_getAssociatedObject(self, property);`è¿™å¥è¯æ˜¯åŠ¨æ€ç»™ç±»æ·»åŠ å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»™ç±»æ·»åŠ äº†ä¸€ä¸ªå±æ€§åä¸º`property `çš„`MJProperty`ç±»å‹å±æ€§ã€‚**æ³¨æ„è¿™é‡Œæ˜¯ä¸€ä¸ªç±»æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„`self`ä»£è¡¨ä»€ä¹ˆã€‚**</div><div class="line"></div><div class="line">è¿™é‡Œçš„ç¼“å­˜æ–¹æ³•æ˜¯é€šè¿‡æ‡’åŠ è½½çš„å½¢å¼å®ç°çš„ï¼Œå°†éœ€è¦ç¼“å­˜çš„å±æ€§åŠ¨æ€æ·»åŠ åˆ°ç±»ä¸Šé¢ã€‚å¦‚æœæ²¡æœ‰åˆ™æ–°åŠ å±æ€§æœ‰åˆ™ç›´æ¥è¿”å›å±æ€§ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¸€ä¸ªç±»å¯èƒ½åœ¨é¡¹ç›®ä¸­ä¼šç”¨åˆ°å¾ˆå¤šæ¬¡å­—å…¸è½¬æ¨¡å‹ã€‚æ‰€ä»¥ä¿å­˜ä¸€ä»½ä¹‹åå°±ä¸ç”¨æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„å±æ€§æ ‡è¯†äº†ã€‚**ä»¥ç©ºé—´æ¢æ—¶é—´**</div><div class="line"></div><div class="line">æŠŠè¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œï¼Œå°±å¾—åˆ°äº†å¦‚ä¸‹ä¸‰ä¸ªå±æ€§çš„å€¼ï¼š</div></pre></td></tr></table></figure>
<p>/<strong> æˆå‘˜å±æ€§ */<br>@property (nonatomic, assign) objc_property_t property;<br>/</strong> æˆå‘˜å±æ€§çš„åå­— <em>/<br>@property (nonatomic, readonly) NSString </em>name;</p>
<p>/<em>* æˆå‘˜å±æ€§çš„ç±»å‹ </em>/<br>@property (nonatomic, readonly) MJPropertyType *type;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">é™¤äº†å…¬å¼€çš„å±æ€§è¿˜æœ‰ä¸¤ä¸ªç§æœ‰å±æ€§ï¼š</div></pre></td></tr></table></figure>
<p>@property (strong, nonatomic) NSMutableDictionary <em>propertyKeysDict;<br>@property (strong, nonatomic) NSMutableDictionary </em>objectClassInArrayDict;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ä»–ä»¬åˆ†åˆ«ä¿å­˜äº†çš„ç±»å‹æ˜¯`MJPropertyKey`</div><div class="line"></div><div class="line">é€šè¿‡</div></pre></td></tr></table></figure>
<p>/**</p>
<ul>
<li><p>è®¾ç½®objectçš„æˆå‘˜å˜é‡å€¼<br>*/</p>
</li>
<li><p>(void)setValue:(id)value forObject:(id)object;<br>/**</p>
</li>
<li><p>å¾—åˆ°objectçš„æˆå‘˜å±æ€§å€¼<br>*/</p>
</li>
<li><p>(id)valueForObject:(id)object;</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">å¯¹ç‰¹å®šçš„å±æ€§å­˜å–å€¼ã€‚</div></pre></td></tr></table></figure>
<p>/<em>* éæ•°ç»„ç±»å‹ </em>/</p>
<ul>
<li>(void)setOriginKey:(id)originKey forClass:(Class)c;</li>
<li>(NSArray *)propertyKeysForClass:(Class)c;</li>
</ul>
<p>/<em>* æ¨¡å‹æ•°ç»„ä¸­çš„ä¿å­˜æ¨¡å‹ç±»å‹ </em>/</p>
<ul>
<li>(void)setObjectClassInArray:(Class)objectClass forClass:(Class)c;</li>
<li>(Class)objectClassInArrayForClass:(Class)c;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&gt; è®°ï¼šæœ¬æ¥è¯¥ä¸Šä¸ªå‘¨å°±å®Œæˆçš„ã€‚æ‹–åˆ°äº†ç°åœ¨è¿˜æ²¡æœ‰åˆ†æå®Œã€‚</div><div class="line"></div><div class="line">## NSObject+MJClass.h</div><div class="line"></div><div class="line">ä»è¿™ä¸ªç±»å¼€å§‹ï¼Œå°±è¿›å…¥äº†åˆ†æ`NSObject`åˆ†ç±»çš„ç¨‹åº¦äº†ã€‚å‰é¢åˆ†æçš„å¯¹è±¡æ˜¯ä¸º`NSObject`æ‰€ä¾èµ–çš„ã€‚</div><div class="line"></div><div class="line">è¿™ä¸ªç±»çš„åŠŸèƒ½å¤§è‡´å¯ä»¥å½’ä¸º`éå†`ã€`å±æ€§ç™½åå•`ã€`å±æ€§é»‘åå•`ã€‚æ‰€ä»¥å¯ä»¥é‡ç‚¹æ¥çœ‹çœ‹è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚</div><div class="line"></div><div class="line">å¤–éƒ¨é€šè¿‡`+ (NSMutableArray *)mj_totalIgnoredPropertyNames;`å’Œ`+ (NSMutableArray *)mj_totalAllowedCodingPropertyNames;`è·å¾—é»‘åå•ä¸ç™½åå•ã€‚</div><div class="line"></div><div class="line">### ç±»çš„éå†</div><div class="line"></div><div class="line">éå†å°±ä¸¤ä¸ªæ–¹æ³•ï¼š</div></pre></td></tr></table></figure>
<ul>
<li>(void)mj_enumerateClasses:(MJClassesEnumeration)enumeration;</li>
<li>(void)mj_enumerateAllClasses:(MJClassesEnumeration)enumeration;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">`mj_enumerateClasses `åªè¦å½“å‰éå†çš„æ˜¯`Foundatoin`æ¡†æ¶çš„å°±ä¼šé€€å‡ºéå†ï¼Œå¦åˆ™ä¼šä¸€ç›´æ²¿ç€ç»§æ‰¿æ ‘éå†ã€‚`mj_enumerateAllClasses `ä¼šéå†ç»§æ‰¿æ ‘ä¸Šæ‰€æœ‰çš„ç±»ã€‚**ä¸ºä»€ä¹ˆä¼šå­˜åœ¨éå†åˆ°`Foundatoin`æ¡†æ¶å°±åœæ­¢éå†äº†ï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„æ¨¡å‹å¤§éƒ¨åˆ†æ˜¯ç»§æ‰¿è‡³NSObjectè¿™ä¸­ç±»å‹ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆåœæ­¢ï¼Œé‚£ä¸ºä»€ä¹ˆè¦éå†ã€‚å› ä¸ºè‡ªå®šä¹‰çš„æ¨¡å‹å¯èƒ½ç»§æ‰¿è‡ªå·±æˆ‘ä»¬è‡ªå®šä¹‰çš„æ¨¡å‹ã€‚ä¸ºäº†ä¿æŠ¤æ‰€æœ‰çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å±æ€§ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦éå†ã€‚**</div><div class="line"></div><div class="line">æ³¨æ„è¿™é‡Œçš„å‚æ•°æ˜¯å…¶å®æ˜¯ä¸€ä¸ª`typedef void (^MJClassesEnumeration)(Class c, BOOL *stop);`Blockã€‚å†™æ³•æœ‰ç‚¹ç±»ä¼¼ç³»ç»Ÿä¸­æ•°ç»„éå†ã€‚è¿™ç§å†™æ³•å€¼å¾—å­¦ä¹ ï¼Œå¹³æ—¶æˆ‘ä»¬éå†éƒ½æ˜¯åœ¨ç±»ä¸­ç›´æ¥è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œé€šè¿‡è¿™æ ·ä¼ é€’`Block`è¿™æ ·å°±æ›´åŠ è§£è€¦äº†ã€‚å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡`Target-Action`æ¨¡å¼å®ç°ã€‚æ³¨æ„è¿™é‡Œçš„`Bool`ç±»å‹ä¼ çš„æ˜¯æŒ‡é’ˆå“¦ï¼Œå°±åƒ`*stop`ã€‚</div><div class="line"></div><div class="line">ç›¸å…³çš„å®ç°ï¼š</div></pre></td></tr></table></figure>
<ul>
<li><p>(void)mj_enumerateClasses:(MJClassesEnumeration)enumeration<br>{<br>// 1.æ²¡æœ‰blockå°±ç›´æ¥è¿”å›<br>if (enumeration == nil) return;</p>
<p>// 2.åœæ­¢éå†çš„æ ‡è®°<br>BOOL stop = NO;</p>
<p>// 3.å½“å‰æ­£åœ¨éå†çš„ç±»<br>Class c = self;</p>
<p>// 4.å¼€å§‹éå†æ¯ä¸€ä¸ªç±»<br>while (c &amp;&amp; !stop) {<br>// 4.1.æ‰§è¡Œæ“ä½œ<br>// å¯¹ä¸€èˆ¬ç±»å‹å–åœ°å€ä¼ é€’<br>enumeration(c, &amp;stop);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 4.2.è·å¾—çˆ¶ç±»</div><div class="line">c = class_getSuperclass(c);</div><div class="line"></div><div class="line">if ([MJFoundation isClassFromFoundation:c]) break;</div></pre></td></tr></table></figure>
<p>}<br>}</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">é‡ç‚¹çœ‹çœ‹è¿™å¥</div></pre></td></tr></table></figure>
<p>// 4.1.æ‰§è¡Œæ“ä½œ<br>// å¯¹ä¸€èˆ¬ç±»å‹å–åœ°å€ä¼ é€’<br>enumeration(c, &amp;stop);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### ç™½åå•é…ç½®</div><div class="line"></div><div class="line">é…ç½®ç™½åå•æ˜¯ä¸ºäº†å¯¹å±æ€§è¿›è¡Œè¿‡æ»¤ã€‚åªæœ‰åœ¨ç™½åå•ä¸­çš„å±æ€§åæ‰ä¼šè¿›è¡Œå­—å…¸å’Œæ¨¡å‹çš„è½¬æ¢ã€‚æ¥è¯´ä¸€ä¸‹è¿™é‡Œæ¶‰åŠçš„é…ç½®æ–¹æ³•ã€‚</div><div class="line"></div><div class="line">å¤–éƒ¨è°ƒç”¨è€…ï¼Œé€šè¿‡ç±»æ–¹æ³•ä¼ å…¥`Block`å‚æ•°è¿›è¡Œé…ç½®ã€‚`typedef NSArray * (^MJAllowedPropertyNames)();`è¿™æ˜¯ä¼ å…¥çš„`Block`å®šä¹‰ã€‚å¯ä»¥çœ‹åˆ°è¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ä¸ºä»€ä¹ˆä¸ç›´æ¥å°†ç™½åå•å±æ€§æš´éœ²å¤„ç†å‡ºæ¥ç»™è°ƒç”¨è€…ç›´æ¥ä½¿ç”¨å‘¢ï¼Ÿå¤§æ¦‚æ˜¯éµå¾ªäº†è®¾è®¡æ¨¡å¼ä¸­çš„`çŸ¥é“æœ€å°‘åŸåˆ™`ã€‚</div><div class="line"></div><div class="line">åœ¨`.m`æ–‡ä»¶ä¸­å®šä¹‰äº†å‡ ä¸ªä¿å­˜ç™½åå•ã€é»‘åå•çš„é™æ€æ•°ç»„ã€‚å®šä¹‰å¦‚ä¸‹ï¼š</div></pre></td></tr></table></figure>
<p>static NSMutableDictionary <em>allowedPropertyNamesDict_;<br>static NSMutableDictionary </em>ignoredPropertyNamesDict<em>;<br>static NSMutableDictionary *allowedCodingPropertyNamesDict</em>;<br>static NSMutableDictionary *ignoredCodingPropertyNamesDict_;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ä¸ºäº†ä¿å­˜ä¼ å…¥çš„Blockä¿¡æ¯ï¼Œéœ€è¦ç»™åˆ†ç±»åŠ¨æ€æ·»åŠ å±æ€§ã€‚</div></pre></td></tr></table></figure>
<p>// åœ¨åˆ†ç±»ä¸­æ–°å¢å±æ€§<br>static const char MJAllowedPropertyNamesKey = â€˜\0â€™; // ç™½åå•<br>static const char MJIgnoredPropertyNamesKey = â€˜\0â€™; // é»‘åå•<br>static const char MJAllowedCodingPropertyNamesKey = â€˜\0â€™; // å½’æ¡£ç™½åå•<br>static const char MJIgnoredCodingPropertyNamesKey = â€˜\0â€™; // å½’æ¡£é»‘åå•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">æ¯”å¦‚è¿™é‡Œçš„`MJAllowedPropertyNamesKey `å°±æ˜¯ç™½åå•ä¼ è¿›æ¥çš„å±æ€§åç§°äº†ã€‚</div><div class="line"></div><div class="line">è®¾ç½®ç™½åå•çš„å…¥å£ï¼š</div></pre></td></tr></table></figure>
<ul>
<li>(void)mj_setupAllowedPropertyNames:(MJAllowedPropertyNames)allowedPropertyNames;<br>{<br>[self mj_setupBlockReturnValue:allowedPropertyNames key:&amp;MJAllowedPropertyNamesKey];<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">æœ€ç»ˆè°ƒç”¨çš„æ˜¯`mj_setupBlockReturnValue`</div></pre></td></tr></table></figure>
<ul>
<li><p>(void)mj_setupBlockReturnValue:(id (^)())block key:(const char *)key<br>{<br>if (block) {<br>objc_setAssociatedObject(self, key, block(), OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>} else {<br>objc_setAssociatedObject(self, key, nil, OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>}</p>
<p>// æ¸…ç©ºæ•°æ®<br>[[self dictForKey:key] removeAllObjects];<br>}</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°è¿™é‡Œå°†blockä½œä¸ºè‡ªèº«çš„å±æ€§ã€‚</div><div class="line"></div><div class="line">**é™¤äº†è¿™ç§æ–¹å¼è¿˜æœ‰ä¸€ç§ï¼š**é‚£å°±æ˜¯åœ¨ç±»ä¸­å®ç°`mj_allowedPropertyNames`æ¯”å¦‚ï¼š</div></pre></td></tr></table></figure>
<ul>
<li>(NSArray *)mj_allowedPropertyNames {<br>return @[@â€nameâ€,@â€iconâ€];<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">åé¢è·å–å¯ç”¨å±æ€§çš„æ—¶å€™ä¼šå¯¹è¿™ä¸¤ç§æ–¹å¼éƒ½åˆ¤æ–­ã€‚</div><div class="line"></div><div class="line">### è®¾ç½®é»‘åå•</div><div class="line"></div><div class="line">è®¾ç½®é»‘åå•çš„æ–¹å¼å’Œè®¾ç½®ç™½åå•ç±»ä¼¼ã€‚</div><div class="line"></div><div class="line">### æœ€ç»ˆå¯è½¬æ¢çš„æ•°ç»„</div><div class="line"></div><div class="line">è°ƒç”¨è¿™ä¸ªæ–¹æ³•`mj_totalIgnoredPropertyNames `å°±æ˜¯è¿”å›ç»è¿‡è¿‡æ»¤åçš„å±æ€§ã€‚</div><div class="line"></div><div class="line">ä¸€å…±æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡`Selecotr`ä¸€ç§æ˜¯é€šè¿‡`Block`è®¾ç½®ã€‚</div></pre></td></tr></table></figure>
<ul>
<li><p>(NSMutableArray <em>)mj_totalObjectsWithSelector:(SEL)selector key:(const char </em>)key<br>{<br>NSMutableArray *array = [self dictForKey:key][NSStringFromClass(self)];<br>if (array) return array;</p>
<p>// åˆ›å»ºã€å­˜å‚¨<br>[self dictForKey:key][NSStringFromClass(self)] = array = [NSMutableArray array];</p>
<p>if ([self respondsToSelector:selector]) {</p>
</li>
</ul>
<h1 id="pragma-clang-diagnostic-push"><a href="#pragma-clang-diagnostic-push" class="headerlink" title="pragma clang diagnostic push"></a>pragma clang diagnostic push</h1><h1 id="pragma-clang-diagnostic-ignored-â€œ-Warc-performSelector-leaksâ€"><a href="#pragma-clang-diagnostic-ignored-â€œ-Warc-performSelector-leaksâ€" class="headerlink" title="pragma clang diagnostic ignored â€œ-Warc-performSelector-leaksâ€"></a>pragma clang diagnostic ignored â€œ-Warc-performSelector-leaksâ€</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSArray *subArray = [self performSelector:selector];</div></pre></td></tr></table></figure>
<h1 id="pragma-clang-diagnostic-pop"><a href="#pragma-clang-diagnostic-pop" class="headerlink" title="pragma clang diagnostic pop"></a>pragma clang diagnostic pop</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    if (subArray) &#123;</div><div class="line">        [array addObjectsFromArray:subArray];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">[self mj_enumerateAllClasses:^(__unsafe_unretained Class c, BOOL *stop) &#123;</div><div class="line">    NSArray *subArray = objc_getAssociatedObject(c, key);</div><div class="line">    [array addObjectsFromArray:subArray];</div><div class="line">&#125;];</div><div class="line">return array;</div></pre></td></tr></table></figure>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#### é€šè¿‡Selector</div><div class="line">`selector`æ˜¯ä½¿ç”¨è€…å¦‚æœæƒ³æ·»åŠ ç™½åå•éœ€è¦è‡ªå®šä¹‰å®ç°ç±»æ–¹æ³•`mj_allowedPropertyNames`ã€‚è¿”å›çš„æ˜¯ä¸€ä¸ªç™½åå•æ•°ç»„ã€‚é»‘åå•åŸç†ç±»ä¼¼ã€‚`key`æ˜¯æŒ‡å®šè¿‡æ»¤çš„æ˜¯ç™½åå•è¿˜æ˜¯é»‘åå•ã€‚</div><div class="line"></div><div class="line">`selector`çš„æ–¹å¼éœ€è¦ç»™å¯¹åº”çš„ç±»æ·»åŠ ä¸€ä¸ªç±»æ–¹æ³•å¦‚ï¼š</div></pre></td></tr></table></figure>
<ul>
<li>(NSArray *)mj_allowedPropertyNames {<br>return @[@â€nameâ€,@â€iconâ€];<br>}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#### é€šè¿‡Block</div><div class="line"></div><div class="line">&gt; ç–‘æƒ‘ï¼šå‰é¢è®¾ç½®çš„æ˜¯ä¸€ä¸ªè¿”å›å€¼ç±»å‹ä¸ºæ•°ç»„çš„`Block`ã€‚ä»£ç ï¼š</div><div class="line"></div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>  if (block) {<br>        objc_setAssociatedObject(self, key, block(), OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>    } else {<br>        objc_setAssociatedObject(self, key, nil, OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>    }</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">ä½†æ˜¯å–å¾—æ—¶å€™åˆæ˜¯ç›´æ¥å–å¾—æ•°ç»„ã€‚éš¾é“è¿™ä¸ªæ—¶å€™`block`ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œç„¶åè¿”å›æ‰§è¡Œç»“æœ</div><div class="line"></div><div class="line">[self mj_enumerateAllClasses:^(__unsafe_unretained Class c, BOOL *stop) &#123;</div><div class="line">NSArray *subArray = objc_getAssociatedObject(c, key);</div><div class="line">[array addObjectsFromArray:subArray];</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p><strong>æœ€åé€šè¿‡å®è·µè¯æ˜ï¼Œç¡®å®èƒ½å¤Ÿä»<code>objc_getAssociatedObject(c, key);</code>å¾—åˆ°å¯¹åº”çš„æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯ä½œä¸ºå±æ€§çš„<code>block</code>æ‰§è¡Œäº†ã€‚</strong></p>
<h2 id="NSObject-MJCoding-h"><a href="#NSObject-MJCoding-h" class="headerlink" title="NSObject+MJCoding.h"></a>NSObject+MJCoding.h</h2><p>è¿™ä¸ªç±»æ˜¯ç”¨äºå½’æ¡£ã€‚åªæœ‰å®ç°äº†<code>MJCoding</code>åè®®çš„ç±»æ‰èƒ½å¤Ÿå½’æ¡£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">/**</div><div class="line"></div><div class="line">*   è¿™ä¸ªæ•°ç»„ä¸­çš„å±æ€§åæ‰ä¼šè¿›è¡Œå½’æ¡£</div><div class="line">    */</div><div class="line"></div><div class="line">*   (NSArray *)mj_allowedCodingPropertyNames;</div><div class="line">    /**</div><div class="line"></div><div class="line">*   è¿™ä¸ªæ•°ç»„ä¸­çš„å±æ€§åå°†ä¼šè¢«å¿½ç•¥ï¼šä¸è¿›è¡Œå½’æ¡£</div><div class="line">    */</div><div class="line"></div><div class="line">*   (NSArray *)mj_ignoredCodingPropertyNames;</div></pre></td></tr></table></figure>
<p>åœ¨è¿›è¡Œå½’æ¡£çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code>Implemenion</code>ä¸­æ·»åŠ <code>MJExtensionCodingImplementation</code>ã€‚</p>
<p>å®é™…ä¸Šæ˜¯å®å®šä¹‰äº†<code>NSCode</code>è¿›è¡Œå½’æ¡£ï¼Œè§£æ¡£ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># define MJCodingImplementation \</div><div class="line"></div><div class="line">*   (id)initWithCoder:(NSCoder *)decoder</div><div class="line">    &#123;</div><div class="line">    if (self = [super init]) &#123;</div><div class="line">    [self mj_decode:decoder];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">    &#125;</div><div class="line">    \</div><div class="line">*   (void)encodeWithCoder:(NSCoder *)encoder</div><div class="line">    &#123;</div><div class="line">    [self mj_encode:encoder];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>çœ‹ä¸€çœ‹å½’æ¡£çš„éƒ¨åˆ†ï¼Œè§£æ¡£çš„æ­¥éª¤ä¸€æ ·ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (void)mj_encode:(NSCoder *)encoder</div><div class="line">    &#123;</div><div class="line">    Class clazz = [self class];</div><div class="line"></div><div class="line">    NSArray *allowedCodingPropertyNames = [clazz mj_totalAllowedCodingPropertyNames];</div><div class="line">    NSArray *ignoredCodingPropertyNames = [clazz mj_totalIgnoredCodingPropertyNames];</div><div class="line"></div><div class="line">    [clazz mj_enumerateProperties:^(MJProperty *property, BOOL *stop) &#123;</div><div class="line">    // æ£€æµ‹æ˜¯å¦è¢«å¿½ç•¥</div><div class="line">    if (allowedCodingPropertyNames.count &amp;&amp; ![allowedCodingPropertyNames containsObject:property.name]) return;</div><div class="line">    if ([ignoredCodingPropertyNames containsObject:property.name]) return;</div></pre></td></tr></table></figure>
<pre><code>  id value = [property valueForObject:self];
  if (value == nil) return;
  [encoder encodeObject:value forKey:property.name];

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</code></pre><p>ç›´æ¥çœ‹é‡ç‚¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">id value = [property valueForObject:self];</div><div class="line">if (value == nil) return;</div><div class="line">[encoder encodeObject:value forKey:property.name];</div></pre></td></tr></table></figure>
<h2 id="NSObject-MJProperty-h"><a href="#NSObject-MJProperty-h" class="headerlink" title="NSObject+MJProperty.h"></a>NSObject+MJProperty.h</h2><p>è¿™ä¸ªç±»ä¿å­˜çš„å±æ€§çš„ä¸€äº›é…ç½®ã€‚å¤§è‡´å¯åˆ†ä¸ºï¼š</p>
<ul>
<li>1.éå†å±æ€§</li>
<li>2.æ–°å€¼é…ç½®</li>
<li>3.keyé…ç½®</li>
<li>4.array model classé…ç½®</li>
</ul>
<h3 id="éå†å±æ€§"><a href="#éå†å±æ€§" class="headerlink" title="éå†å±æ€§"></a>éå†å±æ€§</h3><p><code>+ (void)mj_enumerateProperties:(MJPropertiesEnumeration)enumeration</code>éå†æ‰€æœ‰å±æ€§çš„å…¥å£ã€‚è¿™ä¸ªæ–¹æ³•åœ¨å¾ˆå¤šåœ°æ–¹éƒ½å­˜åœ¨è¿‡ã€‚</p>
<p>å±æ€§ä¼šä»ç¼“å­˜ä¸­å–ï¼Œ<code>NSArray *cachedProperties = [self properties];</code>ã€‚<code>[self properties]</code>æ˜¯ç¼“å­˜å±æ€§çš„éƒ¨åˆ†ã€‚ç„¶åå°±ç›´æ¥éå†æ‰€æœ‰çš„å±æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (void)mj_enumerateProperties:(MJPropertiesEnumeration)enumeration</div><div class="line">    &#123;</div><div class="line">    // è·å¾—æˆå‘˜å˜é‡</div><div class="line">    // ä»ç±»çš„ç»§æ‰¿æ ‘éå†æ¯ä¸€ä¸ªç±»ï¼Œä»ç±»ä¸­è·å¾—å±æ€§</div><div class="line">    NSArray *cachedProperties = [self properties];</div><div class="line"></div><div class="line">    // éå†æˆå‘˜å˜é‡</div><div class="line">    BOOL stop = NO;</div><div class="line">    for (MJProperty *property in cachedProperties) &#123;</div><div class="line">    enumeration(property, &amp;stop);</div><div class="line">    if (stop) break;</div><div class="line">    &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œéå†ç”¨äº†<code>block</code>,å¤–éƒ¨ä¼ é€’<code>block</code>è¿›æ¥éå†ã€‚<code>typedef void (^MJPropertiesEnumeration)(MJProperty *property, BOOL *stop);</code>è¿™ä¸ªåº“å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†ç±»ä¼¼çš„éå†æ–¹å¼ã€‚</p>
<h3 id="æ–°å€¼é…ç½®"><a href="#æ–°å€¼é…ç½®" class="headerlink" title="æ–°å€¼é…ç½®"></a>æ–°å€¼é…ç½®</h3><p>æ–°å€¼é…ç½®æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿï¼šå°±æ˜¯æ”¹å˜ç‰¹å®šçš„å±æ€§çš„åŸæœ‰å€¼ï¼Œè¿™æ ·æ›´åŠ çµæ´»ã€‚</p>
<p>åŒæ ·æœ‰ä¸¤ç§æ–¹å¼<code>Block</code>å’Œ<code>ç±»æ–¹æ³•</code>ã€‚</p>
<p>å­˜å–æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (void)mj_setupNewValueFromOldValue:(MJNewValueFromOldValue)newValueFormOldValue;</div><div class="line">*   (id)mj_getNewValueFromObject:(__unsafe_unretained id)object oldValue:(__unsafe_unretained id)oldValue property:(__unsafe_unretained MJProperty *)property;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>typedef id (^MJNewValueFromOldValue)(id object, id oldValue, MJProperty *property);</code>å…¶å®å’Œä¸‹é¢æ–¹æ³•å‚æ•°å½¢å¼æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>çœ‹äº†ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼Œä¸€æ¬¡åªæ”¯æŒä¸€ä¸ªå±æ€§æ–°å€¼é…ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (void)mj_setupNewValueFromOldValue:(MJNewValueFromOldValue)newValueFormOldValue</div><div class="line">    &#123;</div><div class="line">    objc_setAssociatedObject(self, &amp;MJNewValueFromOldValueKey, newValueFormOldValue, OBJC_ASSOCIATION_COPY_NONATOMIC);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å¦‚ä½•è·å–æ–°ï¼Ÿè‚¯å®šéœ€è¦å…¼å®¹ä¸¤ç§è®¾ç½®æ–¹å¼ï¼Œä¸€ç§<code>Block</code>,ä¸€ç§é€šè¿‡æ–¹æ³•è®¾ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (id)mj_getNewValueFromObject:(__unsafe_unretained id)object oldValue:(__unsafe_unretained id)oldValue property:(MJProperty *__unsafe_unretained)property&#123;</div><div class="line">    // å¦‚æœæœ‰å®ç°æ–¹æ³•</div><div class="line">    if ([object respondsToSelector:@selector(mj_newValueFromOldValue:property:)]) &#123;</div><div class="line">    return [object mj_newValueFromOldValue:oldValue property:property];</div><div class="line">    &#125;</div><div class="line">    // å…¼å®¹æ—§ç‰ˆæœ¬</div><div class="line">    if ([self respondsToSelector:@selector(newValueFromOldValue:property:)]) &#123;</div><div class="line">    return [self performSelector:@selector(newValueFromOldValue:property:) withObject:oldValue withObject:property];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // æŸ¥çœ‹é™æ€è®¾ç½®</div><div class="line">    __block id newValue = oldValue;</div><div class="line">    [self mj_enumerateAllClasses:^(__unsafe_unretained Class c, BOOL *stop) &#123;</div><div class="line">    MJNewValueFromOldValue block = objc_getAssociatedObject(c, &amp;MJNewValueFromOldValueKey);</div><div class="line">    if (block) &#123;</div><div class="line">    newValue = block(object, oldValue, property);</div><div class="line">    *stop = YES;</div><div class="line">    &#125;</div><div class="line">    &#125;];</div><div class="line">    return newValue;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>æ€è·¯å’Œä¸Šé¢åˆ†æç™½åå•ï¼Œé»‘åå•è®¾ç½®çš„æ–¹å¼ä¸€æ ·ã€‚</p>
<h3 id="keyé…ç½®"><a href="#keyé…ç½®" class="headerlink" title="keyé…ç½®"></a>keyé…ç½®</h3><p><code>key</code>é…ç½®æ˜¯è§£å†³å±æ€§åæˆéœ€è¦é‡æ–°å®šä¹‰çš„æƒ…å†µã€‚</p>
<p>è¿™ä¸ªé…ç½®ç»Ÿä¸€é€šè¿‡<code>Block</code>è®¾ç½®ã€‚</p>
<p>è¿™é‡Œæ³¨æ„åˆ°ä¸ºä»€ä¹ˆåœ¨åŠ¨æ€æ·»åŠ äº†å±æ€§ä¹‹åéœ€è¦å°†<code>cachedPropertiesDict_</code>å­—å…¸é‡Œé¢çš„æ¸…ç©ºä¸€æ¬¡ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (void)mj_setupReplacedKeyFromPropertyName:(MJReplacedKeyFromPropertyName)replacedKeyFromPropertyName</div><div class="line">    &#123;</div><div class="line">    [self mj_setupBlockReturnValue:replacedKeyFromPropertyName key:&amp;MJReplacedKeyFromPropertyNameKey];</div><div class="line"></div><div class="line">    [[self dictForKey:&amp;MJCachedPropertiesKey] removeAllObjects];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">*   (void)mj_setupReplacedKeyFromPropertyName121:(MJReplacedKeyFromPropertyName121)replacedKeyFromPropertyName121</div><div class="line">    &#123;</div><div class="line">    objc_setAssociatedObject(self, &amp;MJReplacedKeyFromPropertyName121Key, replacedKeyFromPropertyName121, OBJC_ASSOCIATION_COPY_NONATOMIC);</div><div class="line"></div><div class="line">    [[self dictForKey:&amp;MJCachedPropertiesKey] removeAllObjects];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ç¼“å­˜æ•°ç»„ä¸­çš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚å› ä¸ºæˆ‘ä»¬æ›¿æ¢äº†å±æ€§çš„keyï¼Œæ‰€ä»¥è¦ç”¨æœ€æ–°çš„ã€‚åœ¨è·å–æ‰€æœ‰å±æ€§ä¸­ã€‚æœ‰è¿™ä¹ˆä¸€æ®µï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">NSMutableArray *cachedProperties = [self dictForKey:&amp;MJCachedPropertiesKey][NSStringFromClass(self)];</div></pre></td></tr></table></figure>
<p>if (cachedProperties == nil) {<br>    cachedProperties = [NSMutableArray array];<br>     // éå†ç±»ç»§æ‰¿æ ‘ï¼Œä¸€ç›´éå†åˆ°fondationæ¡†æ¶ã€‚ä¹Ÿå°±æ˜¯åˆ°NSObjectå°±åœæ­¢éå†ã€‚å› ä¸ºæˆ‘ä»¬æ¨¡å‹éƒ½æ˜¯ä»NSObjectå¼€å§‹ç»§æ‰¿çš„<br>    [self mj_enumerateClasses:^(__unsafe_unretained Class c, BOOL *stop) {<br>        // 1.è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡</p>
<pre><code>......
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åªæœ‰å±æ€§ä¸ºç©ºæ‰ä¼šéå†ç±»ï¼Œè·å–æœ€æ–°å±æ€§ã€‚</p>
<h3 id="array-model-classé…ç½®"><a href="#array-model-classé…ç½®" class="headerlink" title="array model classé…ç½®"></a>array model classé…ç½®</h3><p>è¿™ä¸ªæ–¹æ³•æ˜¯å¤„ç†æ¨¡å‹ä¸­åŒ…å«ä¸€å¦ä¸€ä¸ªæ¨¡å‹æ•°ç»„ã€‚<strong>åœ¨å®é™…è¿ç”¨æ¯”è¾ƒå¤šã€‚</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (void)mj_setupObjectClassInArray:(MJObjectClassInArray)objectClassInArray</div><div class="line">    &#123;</div><div class="line">    [self mj_setupBlockReturnValue:objectClassInArray key:&amp;MJObjectClassInArrayKey];</div><div class="line"></div><div class="line">    [[self dictForKey:&amp;MJCachedPropertiesKey] removeAllObjects];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>å’Œä¸Šé¢çš„æ–¹å¼ä¸€æ ·ï¼Œä¼šå°†æœ€ç»ˆä¼šä½œä¸ºç±»çš„ä¸€ä¸ªå±æ€§å°†æ¨¡å‹æ•°ç»„å­—å…¸ä¿å­˜ä¸‹æ¥ã€‚æ–¹ä¾¿åé¢ä½¿ç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">static const char MJReplacedKeyFromPropertyNameKey = &apos;\0&apos;;</div><div class="line">static const char MJReplacedKeyFromPropertyName121Key = &apos;\0&apos;;</div><div class="line">static const char MJNewValueFromOldValueKey = &apos;\0&apos;;</div><div class="line">static const char MJObjectClassInArrayKey = &apos;\0&apos;;</div><div class="line"></div><div class="line">static const char MJCachedPropertiesKey = &apos;\0&apos;;</div></pre></td></tr></table></figure>
<p>è¿™æ˜¯<code>NSObject+MJProperty.h</code>åŠ¨æ€æ·»åŠ çš„æ‰€æœ‰å±æ€§ã€‚é€šè¿‡åå­—å¯ä»¥çŸ¥é“å®ƒçš„ç”¨é€”ã€‚</p>
<h2 id="NSObject-MJKeyValue-h"><a href="#NSObject-MJKeyValue-h" class="headerlink" title="NSObject+MJKeyValue.h"></a>NSObject+MJKeyValue.h</h2><p><strong>è¿™ä¸ªç±»çš„å†…å®¹æœ‰ç‚¹å¤š</strong></p>
<p>è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„åè®®<code>MJKeyValue</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">*   (NSArray *)mj_allowedPropertyNames;</div><div class="line">*   (NSArray *)mj_ignoredPropertyNames;</div><div class="line">*   (NSDictionary *)mj_replacedKeyFromPropertyName;</div><div class="line">*   (id)mj_replacedKeyFromPropertyName121:(NSString *)propertyName;</div><div class="line">*   (NSDictionary *)mj_objectClassInArray;</div><div class="line"></div><div class="line">*   (id)mj_newValueFromOldValue:(id)oldValue property:(MJProperty *)property;</div><div class="line">*   (void)mj_keyValuesDidFinishConvertingToObject;</div><div class="line">*   (void)mj_objectDidFinishConvertingToKeyValues;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„åè®®è§„å®šäº†ç™½åå•ã€é»‘åå•ã€‚ä¹‹å‰åˆ†æè¿‡é€šè¿‡<code>block</code>çš„å½¢å¼åŒæ ·èƒ½å¤Ÿå®ç°é»‘ã€ç™½åå•ã€‚æˆ‘çŒœæµ‹è¿™ä¸ªæ–‡ä»¶æ˜¯å¾ˆä¹…ä¹‹å‰å°±æœ‰äº†ä¸ºäº†å…¼å®¹æ€§ï¼Œæ‰€ä»¥è¿™ç§è®¾ç½®ç™½ã€é»‘åå•çš„æ–¹å¼ä¸€è‡´ä¿ç•™ç€ã€‚</p>
<p><strong>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åˆ†æçš„æœ€åä¸€ä¸ªç±»ï¼Œå¯èƒ½ä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ä¸ªç±»</strong></p>
<p>åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>ç±»æ–¹æ³•<ul>
<li>é”™è¯¯å®šä¹‰</li>
<li>è½¬æ¢å­—å…¸<code>replace</code>è®¾ç½®</li>
<li>æ¨¡å‹è½¬å­—å…¸<ul>
<li>è½¬æ‰€æœ‰å±æ€§</li>
<li>åˆ¶å®šéƒ¨åˆ†å±æ€§è½¬</li>
<li>å¿½ç•¥éƒ¨åˆ†å±æ€§è½¬</li>
<li>æ¨¡å‹æ•°ç»„è½¬å­—å…¸æ•°ç»„</li>
</ul>
</li>
<li>å­—å…¸è½¬æ¨¡å‹<ul>
<li>å­—å…¸è½¬ä¸ºæ¨¡å‹ï¼ˆå¯ä»¥æ˜¯NSDictionaryã€NSDataã€NSStringï¼‰</li>
<li>å­—å…¸è½¬ä¸ºæ¨¡å‹ï¼ˆå¯ä»¥æ˜¯NSDictionaryã€NSDataã€NSStringï¼‰<strong>CoreDataæ”¯æŒ</strong></li>
</ul>
</li>
<li>å­—å…¸æ•°ç»„è½¬æ¨¡å‹æ•°ç»„<ul>
<li>å­—å…¸æ•°ç»„æ¥åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ•°ç»„ï¼ˆå¯ä»¥æ˜¯NSDictionaryã€NSDataã€NSStringï¼‰</li>
<li>å­—å…¸æ•°ç»„æ¥åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ•°ç»„ï¼ˆå¯ä»¥æ˜¯NSDictionaryã€NSDataã€NSStringï¼‰<strong>CoreDataæ”¯æŒ</strong></li>
<li>plistæ¥åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ•°ç»„<ul>
<li>ä»…é™äºmainBundleä¸­çš„æ–‡ä»¶</li>
<li>æ–‡ä»¶å…¨è·¯å¾„</li>
</ul>
</li>
</ul>
</li>
<li>æ¨¡å‹è½¬jsonã€å­—å…¸ã€æ•°ç»„<ul>
<li>è½¬æ¢ä¸ºJSON Data</li>
<li>è½¬æ¢ä¸ºå­—å…¸æˆ–è€…æ•°ç»„</li>
<li>è½¬æ¢ä¸ºJSON å­—ç¬¦ä¸²</li>
</ul>
</li>
</ul>
</li>
<li>å¯¹è±¡æ–¹æ³•<ul>
<li>å­—å…¸è½¬æ¨¡å‹<ul>
<li>å­—å…¸è½¬ä¸ºæ¨¡å‹ï¼ˆå¯ä»¥æ˜¯NSDictionaryã€NSDataã€NSStringï¼‰</li>
<li>å­—å…¸è½¬ä¸ºæ¨¡å‹ï¼ˆå¯ä»¥æ˜¯NSDictionaryã€NSDataã€NSStringï¼‰<strong>CoreDataæ”¯æŒ</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ä¸Šé¢æ‰€åˆ—çš„å†…å®¹å°±æ˜¯è¿™ä¸ªæ¡†æ¶æä¾›ç»™ä½¿ç”¨è€…çš„æ‰€æœ‰åŠŸèƒ½äº†ã€‚è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æŠŠä¹‹å‰åˆ†æçš„å†…å®¹ä¸²åœ¨ä¸€èµ·ã€‚å®ç°è¿™äº›åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬ä»æœ€å¸¸ç”¨çš„<code>+ (instancetype)mj_objectWithKeyValues:(id)keyValues;</code>æ–¹æ³•å…¥æ‰‹ã€‚ä»å¤´åˆ°å°¾èµ°ä¸€éè¿™ä¸ªæµç¨‹ã€‚</p>
<p>ç›´æ¥çœ‹æœ€æ ¸å¿ƒéƒ¨åˆ†ã€‚å…¥å£å°±æ˜¯<code>- (instancetype)mj_setKeyValues:(id)keyValues context:(NSManagedObjectContext *)context</code>è¿™ä¸ªæ–¹æ³•ã€‚æˆ‘ä»¬æŠŠå¤–éƒ¨çš„å­—å…¸ï¼Œjsonä¼ å…¥ï¼Œæœ€ç»ˆæŠŠå­—å…¸çš„<code>key</code>æ˜ å°„åˆ°å¯¹åº”çš„å±æ€§ä¸Šï¼Œ<code>value</code>æˆä¸ºè¿™ä¸ªå±æ€§çš„å€¼ã€‚</p>
<h3 id="å‚æ•°è¿‡æ»¤"><a href="#å‚æ•°è¿‡æ»¤" class="headerlink" title="å‚æ•°è¿‡æ»¤"></a>å‚æ•°è¿‡æ»¤</h3><p>ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯å¯¹å‚æ•°åˆæ³•æ€§è¿›è¡Œæ ¡éªŒã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">keyValues = [keyValues mj_JSONObject];</div></pre></td></tr></table></figure>
<p>MJExtensionAssertError([keyValues isKindOfClass:[NSDictionary class]], self, [self class], @â€keyValueså‚æ•°ä¸æ˜¯ä¸€ä¸ªå­—å…¸â€);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>ç»è¿‡è½¬æ¢åè¿˜ä¸æ˜¯å­—å…¸ç±»å‹å°±ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h3 id="é»‘åå•ï¼Œç™½åå•è¿‡æ»¤"><a href="#é»‘åå•ï¼Œç™½åå•è¿‡æ»¤" class="headerlink" title="é»‘åå•ï¼Œç™½åå•è¿‡æ»¤"></a>é»‘åå•ï¼Œç™½åå•è¿‡æ»¤</h3><p>æ¥ä¸‹æ¥å¦‚æœä½¿ç”¨è€…é…ç½®äº†å±æ€§çš„ç™½åå•æˆ–è€…é»‘åå•ï¼Œåˆ™ä¼šå¯¹å–å‡ºé»‘ç™½åå•ã€‚åœ¨éå†ç±»çš„å±æ€§çš„æ—¶å€™è¿‡æ»¤æ‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">NSArray *allowedPropertyNames = [clazz mj_totalAllowedPropertyNames];</div><div class="line">NSArray *ignoredPropertyNames = [clazz mj_totalIgnoredPropertyNames];</div></pre></td></tr></table></figure>
<p>å› ä¸ºå±æ€§åˆ—è¡¨æ˜¯åœ¨ç±»å¯¹è±¡ä¸Šï¼Œæ‰€ä»¥è‡ªç„¶å»<code>NSObject+MJClass.h</code>è°ƒç”¨ã€‚è¿™ä¸ªç±»ä¸»è¦åŠŸèƒ½å°±æ˜¯æä¾›äº†é»‘ç™½åå•çš„å­˜å‚¨ã€‚</p>
<p><code>NSObject+MJClass.h</code>ä¸­å­˜å‚¨çš„é»‘ç™½åå•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">static const char MJAllowedPropertyNamesKey = &apos;\0&apos;; // ç™½åå•</div><div class="line">static const char MJIgnoredPropertyNamesKey = &apos;\0&apos;; // é»‘åå•</div><div class="line">static const char MJAllowedCodingPropertyNamesKey = &apos;\0&apos;; // å½’æ¡£ç™½åå•</div><div class="line">static const char MJIgnoredCodingPropertyNamesKey = &apos;\0&apos;; // å½’æ¡£é»‘åå•</div></pre></td></tr></table></figure>
<h3 id="éå†ç±»çš„æ‰€æœ‰å±æ€§"><a href="#éå†ç±»çš„æ‰€æœ‰å±æ€§" class="headerlink" title="éå†ç±»çš„æ‰€æœ‰å±æ€§"></a>éå†ç±»çš„æ‰€æœ‰å±æ€§</h3><p>æ¥ä¸‹æ¥å°±æ˜¯å¯¹ç±»çš„æ¯ä¸ªå±æ€§å¤„ç†ï¼Œæ¯”å¦‚æ›¿æ¢ï¼Œå¿½ç•¥ç­‰ã€‚æ¶‰åŠåˆ°å±æ€§çš„æ˜¯åœ¨<code>NSObject+MJProperty.h</code>ç±»ä¸­å®Œæˆçš„ã€‚æ¯”å¦‚éå†å°±æ˜¯ã€‚</p>
<p>é€šè¿‡ä¼ å…¥<code>block</code>,åœ¨éå†çš„åŒæ—¶å¯¹å±æ€§å°±è¡Œå¤„ç†ã€‚å½¢å¼å°±åƒé€šè¿‡<code>enumerateObjectsUsingBlock:</code>éå†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[someArray enumerateObjectsUsingBlock:^(id _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</div></pre></td></tr></table></figure>
<p>}]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<p>éå†å±æ€§</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">[clazz mj_enumerateProperties:^(MJProperty *property, BOOL *stop) &#123;</div><div class="line">......</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>å¦‚æœå±æ€§åœ¨ç™½åå•æˆ–è€…é»‘åå•ä¸­å‡ºç°åœ¨åˆ™ç›´æ¥è·³å‡ºè¿™æ¬¡å¾ªç¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">if (allowedPropertyNames.count &amp;&amp; ![allowedPropertyNames containsObject:property.name]) return;</div><div class="line">if ([ignoredPropertyNames containsObject:property.name]) return;</div></pre></td></tr></table></figure>
<p>å–å‡ºå±æ€§å¯¹åº”çš„å€¼ï¼Œå½“ç„¶è¿™é‡Œå¢åŠ äº†å¯¹å€¼å¾—è¿‡æ»¤ï¼Œæ¯”å¦‚è®¾ç½®äº†æ–°å€¼æ›¿æ¢æ—§çš„å€¼ã€‚å¦‚æœæœ€ç»ˆå–å‡ºçš„ç»“æœä¸­æ²¡æœ‰å€¼ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">id value;</div><div class="line"></div><div class="line">NSArray *propertyKeyses = [property propertyKeysForClass:clazz];</div><div class="line">for (NSArray *propertyKeys in propertyKeyses) &#123;</div><div class="line">value = keyValues;</div><div class="line">for (MJPropertyKey *propertyKey in propertyKeys) &#123;</div><div class="line">value = [propertyKey valueInObject:value];</div><div class="line">&#125;</div><div class="line">if (value) break;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// å€¼çš„è¿‡æ»¤</div><div class="line">id newValue = [clazz mj_getNewValueFromObject:self oldValue:value property:property];</div><div class="line">if (newValue != value) &#123; // æœ‰è¿‡æ»¤åçš„æ–°å€¼</div><div class="line">[property setValue:newValue forObject:self];</div><div class="line">return;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// å¦‚æœæ²¡æœ‰å€¼ï¼Œå°±ç›´æ¥è¿”å›</div><div class="line">if (!value || value == [NSNull null]) return;</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹é‡Œå°±æ˜¯æœ€ç»ˆå¤„ç†éƒ¨åˆ†äº†ã€‚è¿™æ—¶å€™å±æ€§çš„<code>key</code>å’Œ<code>value</code>éƒ½æ˜¯åˆæ³•çš„äº†ã€‚</p>
<ul>
<li>1.å‰©ä¸‹çš„å°±æ˜¯å¤„ç†å±æ€§ã€‚æ¯”å¦‚è®²ä¸å¯å˜æ•°ç»„è½¬ä¸ºå¯å˜æ•°ç»„ã€‚</li>
<li>2.å¦‚æœä¸æ˜¯<code>Foundation</code>æ¡†æ¶çš„ç±»ï¼Œä¹Ÿå°±æ˜¯ç»§æ‰¿è‡³è‡ªå®šä¹‰æ¨¡å‹çš„éœ€è¦é€’å½’éå†ã€‚</li>
<li>3.å¯¹æ¨¡å‹æ•°ç»„çš„å¤„ç†</li>
<li>4.å¦‚æœæ˜¯<code>Foundation</code>æ¡†æ¶ä¸­çš„ã€‚è¿™ä¸ªéƒ¨åˆ†å°±å¯ä»¥ç›´æ¥ç»™<code>value</code>èµ‹å€¼äº†ã€‚</li>
<li>5.æœ€ç»ˆ<code>KVC</code>ç»™å±æ€§èµ‹å€¼ã€‚<code>[property setValue:value forObject:self];</code><br>```</li>
</ul>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>åšæŒæŠ€æœ¯åˆ†äº«ï¼Œæ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œï¼</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpeg" alt="Bonway WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpeg" alt="Bonway Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOSæºç è§£æ/"  <i class="fa fa-tag"></i> iOSæºç è§£æ</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/08/iOS-WKWebViewé€‚é…/" rel="next" title="iOS WKWebViewé€‚é…">
                <i class="fa fa-chevron-left"></i> iOS WKWebViewé€‚é…
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/08/iOS-WKWebView-åŸºæœ¬ä½¿ç”¨/" rel="prev" title="iOS WKWebViewåŸºç¡€ä½¿ç”¨">
                iOS WKWebViewåŸºç¡€ä½¿ç”¨ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="åˆ†äº«åˆ°æ–°æµªå¾®åš"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="åˆ†äº«åˆ°è±†ç“£ç½‘"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="åˆ†äº«åˆ°QQå¥½å‹"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="åˆ†äº«åˆ°QQç©ºé—´"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="åˆ†äº«åˆ°å¾®ä¿¡"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="åˆ†äº«åˆ°ç™¾åº¦è´´å§"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="åˆ†äº«åˆ°Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="åˆ†äº«åˆ°Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "åˆ†äº«åˆ°ï¼š",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="SOHUCS"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/mine.png"
               alt="Bonway" />
          <p class="site-author-name" itemprop="name">Bonway</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="mailto:421817275@qq.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="tencent://421817275" target="_blank" title="QQ">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#å…³é”®ç±»"><span class="nav-number">1.</span> <span class="nav-text">å…³é”®ç±»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MJExtensionConst"><span class="nav-number">2.</span> <span class="nav-text">MJExtensionConst</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pragma-clang-diagnostic-push"><span class="nav-number"></span> <span class="nav-text">pragma clang diagnostic push</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pragma-clang-diagnostic-ignored-â€œ-Warc-performSelector-leaksâ€"><span class="nav-number"></span> <span class="nav-text">pragma clang diagnostic ignored â€œ-Warc-performSelector-leaksâ€</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pragma-clang-diagnostic-pop"><span class="nav-number"></span> <span class="nav-text">pragma clang diagnostic pop</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NSObject-MJCoding-h"><span class="nav-number">1.</span> <span class="nav-text">NSObject+MJCoding.h</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NSObject-MJProperty-h"><span class="nav-number">2.</span> <span class="nav-text">NSObject+MJProperty.h</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#éå†å±æ€§"><span class="nav-number">2.1.</span> <span class="nav-text">éå†å±æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ–°å€¼é…ç½®"><span class="nav-number">2.2.</span> <span class="nav-text">æ–°å€¼é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keyé…ç½®"><span class="nav-number">2.3.</span> <span class="nav-text">keyé…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#array-model-classé…ç½®"><span class="nav-number">2.4.</span> <span class="nav-text">array model classé…ç½®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NSObject-MJKeyValue-h"><span class="nav-number">3.</span> <span class="nav-text">NSObject+MJKeyValue.h</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‚æ•°è¿‡æ»¤"><span class="nav-number">3.1.</span> <span class="nav-text">å‚æ•°è¿‡æ»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é»‘åå•ï¼Œç™½åå•è¿‡æ»¤"><span class="nav-number">3.2.</span> <span class="nav-text">é»‘åå•ï¼Œç™½åå•è¿‡æ»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#éå†ç±»çš„æ‰€æœ‰å±æ€§"><span class="nav-number">3.3.</span> <span class="nav-text">éå†ç±»çš„æ‰€æœ‰å±æ€§</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2018</span>
  
  <span class="author" itemprop="copyrightHolder">Bonway</span>
</div>



Powered by <a href="http://blog.linqipuzi.com/" target="_blank">Bonway</a>
Â·æµ™ICPå¤‡18006992å· <a href="http://blog.linqipuzi.com/" target="_blank"></a>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">åšå®¢å…¨ç«™å…±å­—</span>
</div>

        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cytrMgNxf';
      var conf = 'bc060e5ba4249731b1c8b8e92d032584';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("vSIGWaVuClR8KRBO8C13a5k0-gzGzoHsz", "snxTUFWhWzp3gYHYljaCIjAh");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  


</body>
</html>

